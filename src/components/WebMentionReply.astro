---
import Avatar from "./Avatar.astro";
import { formatDate } from '../utils/formatDate';

const { webmention } = Astro.props;
---

<article class="webmention" id={`webmention-${webmention['wm-id']}`}>
    {webmention.author ? (
        <div class="webmention__meta">
            <Avatar src={webmention.author.photo} alt={webmention.author.name} small />
            <a href={webmention.url} target="_blank" rel="noreferrer noopener">
                <span>
                    <strong>{webmention.author.name}</strong>
                </span>
            </a>
            <time class="h6" datetime={webmention.published}>
                {formatDate(webmention.published)}
            </time>
        </div>
    ) : (
        <div class="webmention__meta">
            <span>
                <strong>Anonymous</strong>
            </span>
        </div>
    )}

  <div class="webmention__text">
      {webmention.content.text}

      {webmention.url && (
          <a href={webmention.url} target="_blank" rel="noopener noreferrer">
            <span>source</span>
            <svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512" width="10px"><path fill="currentColor" d="M432 320h-32a16 16 0 00-16 16v112H64V128h144a16 16 0 0016-16V80a16 16 0 00-16-16H48a48 48 0 00-48 48v352a48 48 0 0048 48h352a48 48 0 0048-48V336a16 16 0 00-16-16zM488 0H360c-21.37 0-32.05 25.91-17 41l35.73 35.73L135 320.37a24 24 0 000 34L157.67 377a24 24 0 0034 0l243.61-243.68L471 169c15 15 41 4.5 41-17V24a24 24 0 00-24-24z"></path></svg>
          </a>
      )}
  </div>
</article>

<style>
    .webmention {
        padding: var(--spacer-sm);
        background: var(--chisel-neutral-200);
    }

    .webmention:not(:last-of-type) {
        margin-bottom: var(--spacer-md);
    }

    .webmention__meta {
        display: flex;
        flex-direction: row;
        gap: var(--spacer-xs);
        align-items: center;
    }

    .webmention__meta a {
        margin-top: 0;
    }

    .webmention__meta strong {
        font-weight: 500;
    }

    .webmention__meta time {
        flex: 1 0 0%;
        text-align: end;
        margin-top: 0;
    }

    .webmention__text a {
        font-size: 0.875em;
        margin-left: var(--spacer-xs);
    }

    .webmention__text a svg {
        margin-left: var(--spacer-tiny);
    }
</style>